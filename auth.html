<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Auth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <script>
        var thing = window.location.search.split(/[?&=]/)

        var code = thing[2]
        var state = thing[4]

        if (state == localStorage.state) {
            localStorage.removeItem('state')

            var xhr = new XMLHttpRequest()
        xhr.open('POST', 'https://github.com/login/oauth/access_token?'+
                         'cliend_id=2833b352b7b6f3738102&'+
                         'client_secret=61fa4f365c80786660b2c5a7ffa47af952d073a2&'+
                         'code='+code+'&'+
                         'redirect_uri=https://thegrandcircuit.github.io/IT2/auth.html&'+
                         'state='+state
        , true)
        xhr.responseType = 'json'
        xhr.onload = function () {
            if (this.status == 200) {
               localStorage.setItem('auth',JSON.parse(this.response))
            } else {
                alert(this.response)
            }
        }
        xhr.send()

        } else {
            localStorage.removeItem('state')
            window.close()
        }
    </script>

</body>

</html>